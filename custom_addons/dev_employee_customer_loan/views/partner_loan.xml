<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="sequence_partner_loan" model="ir.sequence">
            <field name="name">Loan Application</field>
            <field name="code">partner.loan</field>
            <field name="prefix">LOAN/%(year)s/</field>
            <field name="padding">5</field>
            <field name="number_next">1</field>
            <field name="number_increment">1</field>
        </record>

        <record id="partner_loan_search_view" model="ir.ui.view">
            <field name="name">partner.loan.tree.view</field>
            <field name="model">partner.loan</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Loan Application">
					<field name="name"/>
					<field name="partner_id"/>
					<field name="loan_type"/>
                    <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]"/>
                     <filter name="confirm" string="Confirmed" domain="[('state', '=', 'confirm')]"/>
                     <filter name="done" string="Paid" domain="[('state', '=', 'done')]"/>
                    <group expand="0" name="group_by" string="Group By">
                       <filter name="borrower" string="Applicant" domain="[]" context="{'group_by' : 'partner_id'}" />
                       <filter string="Loan Type" context="{'group_by': 'loan_type'}"/>
                       <filter string="Status" context="{'group_by': 'state'}"/>
                   </group>
                </search>
            </field>
        </record>

        <record id="partner_loan_tree_view" model="ir.ui.view">
            <field name="name">partner.loan.tree.view</field>
            <field name="model">partner.loan</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Loan Application">
					<field name="name"/>
					<field name="partner_id"/>
					<field name="loan_type"/>
					<field name="calc_principle_amount"/>
					<field name="calc_interest_rate"/>
					<field name="calc_months"/>
					<field name="calc_monthly_emi"/>
                </tree>
            </field>
        </record>


        <record id="partner_loan_form_view" model="ir.ui.view">
            <field name="name">partner.loan.form.view</field>
            <field name="model">partner.loan</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Lender Loans">
                    <header>
                        <button string="Confirm" type="object" name="generate_emi_lines" states="draft" class="oe_highlight"/>
                        <button string="Post Next Entry" type="action" name="%(action_partner_loan_payment)d" context="{'loan_id': active_id}" states="confirm" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done"/>

                    </header>
                    <sheet>
                        <h2><field name="name" nolabel="1" readonly="1"/></h2>
                        <group col="4">
                            <field name="partner_id"/>
                            <field name="loan_type" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="calc_principle_amount" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="calc_interest_rate" attrs="{'readonly':[('state','!=','draft')]}" required="1"/>
                            <field name="calc_months" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="calc_monthly_emi" readonly="1"/>
                            <field name="loan_release_date" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="due_every_month" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="loan_maturity_date" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="payment_delay" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="accounting_commencement_date" attrs="{'readonly':[('state','!=','draft')]}"/>
                        </group>
                        <button string="Calculate EMI" type="object" name="emi_calc" states="draft" class="oe_highlight"/>
                        <notebook>
<!-- states="confirm,done" -->
                            <page string="EMI Lines" >
                                <field name="emi_lines" nolabel="1" >
                                    <tree orderby="sequence">
                                        <field name="sequence" invisible="1"/>
                                        <field name="transaction_date"/>
                                        <field name="fund_type"/>
                                        <field name="due_date" />
                                        <!-- <field name="payment_method"/>
                                        <field name="payment_date"/> -->
                                        <field name="funding_amount"/>
                                        <!-- <field name="payment_amt"/> -->
                                        <field name="outstanding_amount"/>
                                        <field name="principle_payment"/>
                                        <field name="outstanding_Interest"/>
                                        <field name="interest_payment"/>
                                        <field name="state"/>
                                        <field name="account_move"/>
                                    </tree>
                                </field>
                            </page>
                            <!-- <page string="Process Fees">
                                <field name="process_fee_ids"/>
                            </page> -->
                            <page string="Proofs">
                                <field name="proof_ids" nolabel="1"/>
                            </page>
                            <page string="Configuration">
                                <group col="4">
                                    <field name="bank_journal_id" domain="[('type','=','purchase')]"/>
                                    <field name="loan_int_account"/>
                                    <field name="loan_account"/>
                                    <field name="interest_product"/>
                                    <field name="loan_product"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_partner_loan" model="ir.actions.act_window">
            <field name="name">Lender Loans</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">partner.loan</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


        <record id="sequence_loan_emi_line" model="ir.sequence">
            <field name="name">Loan EMI</field>
            <field name="code">loan.emi.line</field>
            <field name="prefix">EMI/%(year)s/</field>
            <field name="padding">5</field>
            <field name="number_next">1</field>
            <field name="number_increment">1</field>
        </record>

        <record id="loan_emi_line_search_view" model="ir.ui.view">
            <field name="name">loan.emi.line.view</field>
            <field name="model">loan.emi.line</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Loan Application">
					<field name="loan_id"/>
					<field name="partner_id"  />
					<field name="payment_method"/>
                    <filter name="pending" string="Pending" domain="[('state', '=', 'draft')]"/>
                     <filter name="done" string="Posted" domain="[('state', '=', 'done')]"/>
                    <group expand="0" name="group_by" string="Group By">
                       <filter name="borrower" string="Lender" domain="[]" context="{'group_by' : 'partner_id'}" />
                       <!--<filter string="Payment Type" context="{'group_by': 'payment_method'}"/> -->
                        <filter string="Monthly" context="{'group_by': 'transaction_date'}" name="date" />
                        <filter string="Status" context="{'group_by': 'state'}"/>
                        <filter string="Loan" context="{'group_by': 'loan_id'}"/>
                   </group>
                </search>
            </field>
        </record>

        <record id="loan_emi_line_tree_view" model="ir.ui.view">
            <field name="name">loan.emi_line.tree.view</field>
            <field name="model">loan.emi.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Loan EMIs">
                    <field name="loan_id"/>
                    <field name="partner_id"/>
                    <field name="transaction_date"/>
                    <field name="fund_type"/>
                    <!-- <field name="payment_method"/> -->
                    <field name="funding_amount"/>
                    <field name="outstanding_amount"/>
                    <field name="principle_payment"/>
                    <field name="outstanding_Interest"/>
                    <field name="interest_payment"/>
                     <field name="account_move"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="loan_emi_line_form_view" model="ir.ui.view">
            <field name="name">loan.emi.line.form.view</field>
            <field name="model">loan.emi.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Loan EMIs">
                    <sheet>
                        <h2><field name="name" nolabel="1" readonly="1"/></h2>
                        <group col="4">
                            <field name="loan_id"/>
                            <field name="transaction_date"/>
                            <field name="fund_type"/>
                            <!-- <field name="payment_method"/> -->
                            <field name="funding_amount"/>
                            <field name="outstanding_amount"/>
                            <field name="principle_payment"/>
                            <field name="outstanding_Interest"/>
                            <field name="interest_payment"/>
                             <field name="account_move"/>
                            <field name="state"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_loan_emi_line" model="ir.actions.act_window">
            <field name="name">Loan EMIs</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">loan.emi.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


        <record id="action_loan_emi_report" model="ir.actions.act_window">
            <field name="name">Installment to Post</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">loan.emi.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        	<field name="context">{'search_default_date': 1,
                'search_default_pending':1}</field>  
            <field name="domain">[('funding_amount','>',0.00),('fund_type','!=','Principle Amount'),('fund_type','!=','Principal Amount')]</field>
        </record>

         <record id="loan_process_fee_tree_view" model="ir.ui.view">
            <field name="name">loan.process.fee.tree.view</field>
            <field name="model">loan.process.fee</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Process Fee" editable="bottom">
					<field name="processing_item"/>
					<field name="item_provider"/>
					<field name="item_fee" sum="Total"/>
					<field name="payable_by"/>
                </tree>
            </field>
        </record>

        <record id="loan_process_fee_form_view" model="ir.ui.view">
            <field name="name">loan.process.fee.tree.view</field>
            <field name="model">loan.process.fee</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Process Fee">
                    <sheet>
                        <group col="4">
                           <field name="processing_item"/>
                            <field name="item_provider"/>
                            <field name="item_fee"/>
                            <field name="payable_by"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_loan_process_fee" model="ir.actions.act_window">
            <field name="name">Process Fee</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">loan.process.fee</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

         <record id="view_account_loan_proof_type_tree" model="ir.ui.view">
            <field name="name">view.account.loan.proof.type.tree</field>
            <field name="model">loan.proof.type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Loan Proof Type" editable="bottom">
                    <field name="name"/>
                    <field name="short_name"/>
                    <field name="p_document" filename="p_name"/>
                    <field name="p_name" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="view_account_loan_proof_type_form" model="ir.ui.view">
            <field name="name">view.account.loan.proof.type.tree</field>
            <field name="model">loan.proof.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Loan Proof Type">
                    <group col="4" colspan="4">
					    <field name="name"/>
					    <field name="short_name"/>
                        <field name="p_document" filename="p_name"/>
                        <field name="p_name" invisible="1"/>
				    </group>
                </form>
            </field>
        </record>

        <record id="action_account_loan_proof_type" model="ir.actions.act_window">
            <field name="name">Loan Proof Type</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">loan.proof.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


        <menuitem id="partner_loan_main_menu" web_icon="dev_employee_customer_loan,static/description/icon.png" name="Loan Management"/>
        <menuitem id="loan_application_menu" name="Loans" parent="partner_loan_main_menu" sequence="0"/>
        <menuitem id="personal_loan_menu" name="Lender Loans" parent="loan_application_menu" action="action_partner_loan"/>
        <!-- <menuitem id="loan_emi_line" name="Loan EMIs" parent="loan_application_menu" action="action_loan_emi_line"/> -->
        <!-- <menuitem id="loan_configuration" name="Configuration" parent="partner_loan_main_menu" sequence="2"/> -->
        <menuitem id="loan_report" name="Report" parent="partner_loan_main_menu" sequence="1"/>
        <menuitem id="menu_action_loan_emi_report" action="action_loan_emi_report" name="Installments to Post" parent="loan_report" sequence="2"/>
        <!-- <menuitem id="menu_action_partner_form" action="base.action_partner_form" name="Applicants" parent="loan_configuration" sequence="2"/> -->

            <!--<menuitem id="process_fee_menu" name="Process Fee" parent="loan_application_menu" action="action_loan_process_fee"/>-->

    </data>
</openerp>