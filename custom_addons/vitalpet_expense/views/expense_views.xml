<?xml version="1.0" ?>
<odoo>
	<!-- Cron that creates tasks for unapproved expenses -->
         <record id="ir_cron_create_expense_tasks" model="ir.cron">
            <field name="name">Create HR Expenses Tasks</field>
            <field eval="True" name="active" />
            <field name="user_id" ref="base.user_root" />
            <field name="interval_number">01</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field eval="False" name="doall" />
            <field eval="'hr.expense.sheet'" name="model"/>
            <field name="function">_create_expense_task_cron</field>
            <field name="args">()</field>
        </record>


	<!-- Employee -->
	<record id="view_employee_form_inherited_expense_ofx" model="ir.ui.view">
		<field name="name">hr.employee.form</field>
		<field name="model">hr.employee</field>
		<field name="inherit_id" ref="hr.view_employee_form" />
		<field name="arch" type="xml">
			<xpath expr="//form/sheet/notebook/page[3]" position="inside">
				<group string="Expenses">
					<field name="credit_card_id"
						domain="[('company_id', '=', company_id),('corporate_card','=','True'),('supplier','=','True'),('assigned_to_id', '=', False)]"
						options="{'no_create': True}" />
				</group>
			</xpath>
		</field>
	</record>

	<record id="view_expenses_tree_inherit" model="ir.ui.view">
		<field name="name">hr.expense.tree</field>
		<field name="model">hr.expense</field>
		<field name="inherit_id" ref="hr_expense.view_expenses_tree" />
		<field name="arch" type="xml">
			<xpath expr="//tree" position="attributes">
				<attribute name="colors">red: total_amount &gt; attachment_hidden
					and attachment_number == 0
				</attribute>
			</xpath>
			<xpath expr="//field[@name='date']" position="replace">
				<field name="date" string="Accounting Date" />
			</xpath>
			<xpath expr="//field[@name='name']" position="replace">
				<field name="name" string="Expense Sheet" />
			</xpath>

			<xpath expr="//field[@name='total_amount']" position="replace">
				<field name="total_amount" string="Total Amount" />
			</xpath>

			<xpath expr="//field[@name='state']" position="attributes">
				<attribute name="invisible">True</attribute>
			</xpath>

			<xpath expr="//field[@name='date']" position="after">
				<field name="company_id" />
				<field name="product_id" />
				<field name="payment_mode" />
			</xpath>
			<xpath expr="//field[@name='state']" position="after">
				<field name="attachment_hidden" invisible="1" />
			</xpath>
			
			

		</field>
	</record>

	<record id="view_hr_expense_sheet_form_inherited_bank_statement"
		model="ir.ui.view">
		<field name="name">hr.expense.sheet.form</field>
		<field name="model">hr.expense.sheet</field>
		<field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form" />
		<field name="arch" type="xml">
			<xpath expr="//button[@name='%(hr_expense.hr_expense_register_payment_wizard_action)d']" position="attributes">
				<attribute name="invisible">True</attribute>
			</xpath>
			<xpath expr="//form/header/button[@name='action_sheet_move_create']"
				position="attributes">
				<attribute name="groups">hr_expense.group_hr_expense_manager
				</attribute>
			</xpath>
			<xpath expr="//field[@name='expense_line_ids']//field[@name='date']"
				position="after">
				<field name="product_id" />
				<field name="source" />
			</xpath>
			<field name='journal_id' position='after'>
				<field name='user_id' invisible='1' />
				<field name='role' invisible='1' />
			</field>
			<xpath expr="//field[@name='expense_line_ids']" position="attributes">
				<attribute name="attrs">{'readonly':[('state','!=','submit')]}
				</attribute>
			</xpath>

			<field name="journal_id" position="attributes">
				<attribute name="attrs">{'invisible':
					[('payment_mode','=','company_account')]}
				</attribute>

				<attribute name="domain">
					[('type', '=', 'purchase'), ('company_id',
					'=', company_id)]
				</attribute>
			</field>
		</field>
	</record>

	<record id="view_hr_expense_filter" model="ir.ui.view">
		<field name="name">hr.expense.filter</field>
		<field name="model">hr.expense</field>
		<field name="inherit_id" ref="hr_expense.view_hr_expense_filter" />
		<field name="arch" type="xml">
			<group expand="0" string="Group By">
				<filter string="Expense Description" domain="[]"
					context="{'group_by': 'name'}" />
			</group>
			<group expand="0" string="Group By">
				<filter string="Payment By" domain="[]"
					context="{'group_by': 'payment_mode'}" />
			</group>
		</field>
	</record>


	<record id="hr_expense_form_view_inherited_bank_statement"
		model="ir.ui.view">
		<field name="name">hr.expense.form</field>
		<field name="model">hr.expense</field>
		<field name="inherit_id" ref="hr_expense.hr_expense_form_view" />
		<field name="arch" type="xml">
			<xpath expr="//field[@name='tax_ids']" position="after">
				<field name="expense_description" />
<!-- 				<field name="account" invisible='1'/>
 -->			</xpath>

			<xpath expr="//form/header/button" position='attributes'>
				<attribute name='context'>{'default_company_id':company_id}
				</attribute>
			</xpath>

			<xpath expr="//field[@name='payment_mode']" position="after">
				<field name="credit_card_id"
					attrs="{'invisible': [('payment_mode','!=','credit_card')]}"
					readonly="1" />
			</xpath>

			<xpath expr="//field[@name='analytic_account_id']" position="attributes">
				<attribute name="domain">[('expensed', '=', True)]</attribute>
			</xpath>
			<xpath expr="//field[@name='analytic_account_id']" position="after">
				<field name="analytic_account_view" invisible="1" />
			</xpath>
			<field name="analytic_account_id" position="attributes">
				<attribute name="attrs">{'readonly':
					[('analytic_account_view','=',False)],'required':
					[('analytic_account_view','!=',False)]}
				</attribute>
				<attribute name="options">{'no_quick_create': True, 'no_create_edit' : True}</attribute>
			</field>
			<field name="product_id" position="attributes">
				<attribute name="options">{'no_open': True,'create_edit,': True,'no_create': True}
				</attribute>
			</field>
		</field>
	</record>


	<!-- <record model="ir.ui.view" id="myreceipt_kanban_view"> <field name="name">student 
		kanban view</field> <field name="model">hrexpense.myreceipt</field> <field 
		name="arch" type="xml"> <kanban> <field name="name" /> <templates> <t t-name="kanban-box"> 
		<div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click"> 
		<div class="oe_kanban_content"> <a type="open"> <div> <field name="name" 
		/> </div> </a> <div class="oe_kanban_details"> <h4 class="oe_partner_heading"> 
		<a type="open"> <field name="name" /> </a> </h4> <ul> <li> <field name="name" 
		/> </li> </ul> </div> <div class="o_kanban_footer"> <div class="row"> <div 
		class="col-xs-3"> <div class="oe_kanban_partner_links"> <span class="badge" 
		t-if="record.fn.value&gt;0"> <i class="fa fa-fw fa-star" /> <t t-esc="record.fn.value" 
		/> </span> </div> </div> <div class="col-xs-3"> <div class="oe_kanban_partner_links"> 
		<span class="badge" t-if="record.maths_marks.value&gt;0"> <i class="fa fa-fw 
		fa-book" /> <t t-esc="record.maths_marks.value" /> </span> </div> </div> 
		<div class="col-xs-3"> <strong> <span class="pull-right text-right"> <field 
		name="state" widget="kanban_label_selection" options="{'classes': {'new': 
		'default', 'cancel': 'warning', 'inprogress': 'success'}}" /> </span> </strong> 
		</div> <div class="col-xs-3"> <img class="oe_kanban_avatar pull-right" t-att-src="kanban_image('res.users', 
		'image', record.user_id.raw_value)" t-att-title="record.user_id.value" width="24" 
		height="24" /> </div> </div> </div> </div> </div> </t> </templates> </kanban> 
		</field> </record> -->

	<!-- RECEIPTS KANBAN VIEW -->

	<record model="ir.ui.view" id="receipts_kanban_view">
		<field name="name">My Receipts</field>
		<field name="model">hrexpense.myreceipt</field>
		<field name="arch" type="xml">
			<kanban create="false">
				<field name="name" />
				<field name="attachment" />
				<field name="sender" />

				<templates>
					<field name="mimetype" />
					<field name="employee_id" />
					<field name="sender" />
					<t t-name="kanban-box">
						<div class="coe_kanban_card">
							<div class="row">
								<div class="col-md-12 ">
									<div class="col-md-7">
										<a type="delete">
											<i class="fa fa-times" aria-hidden="true">
											</i>
										</a>
										<t t-if="record.employee_id">
											<span style=" font-weight:bold; font-size:14px;">
												<field name="employee_id" />
											</span>
										</t>

										<span
											style="font-weight:bold; font-size:14px;display: block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
											<field name="sender"
												attrs="{'invisible': [('employee_id', '!=', False)]}" />
										</span>
									</div>
									<div class="col-md-5">
										<field name="submit_date" />
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-12">
									<div class="col-md-7">
										<strong>

											<!-- <t t-esc="{record.attachment.value}"></t> -->
											<t t-set="webimage"
												t-value="new RegExp('image.*(gif|jpeg|jpg|png)').test(record.mimetype.value)" />
											<div t-if="!webimage" class="o_image"
												t-att-data-mimetype="record.mimetype.value" />
											<div t-if="webimage">

												<img class="img-responsive"
													t-att-src="kanban_image('hrexpense.myreceipt', 'attachment', record.id.raw_value)" />
											</div>



										</strong>
									</div>
									<div class="col-md-5">
										<ul>
											<li>
												<a type="object" name="action_add_to_expenses">Add to expenses</a>
											</li>
										</ul>
										<span style="font-weight:bold; font-size:12px;">
											Sub:
											<field name="subject" />
										</span>
									</div>
								</div>
							</div>
						</div>
					</t>
				</templates>
			</kanban>
		</field>
	</record>

	<!-- MY RECEIPT FORM VIEW -->

	<record id="my_receipts_form_view" model="ir.ui.view">
		<field name="name">My Receipts</field>
		<field name="model">hrexpense.myreceipt</field>
		<field name="arch" type="xml">
			<form>
				<sheet>
					<group>
						<field name="attachment" widget="image" class="image_file" />
						<field name="name" string="Name" />
						<field name="sender" />

					</group>
				</sheet>
			</form>
		</field>
	</record>


	<!-- MY RECEIPT TREE VIEW -->
	<record id="my_receipts_tree_view" model="ir.ui.view">
		<field name="name">My Receipts</field>
		<field name="model">hrexpense.myreceipt</field>
		<field name="arch" type="xml">
			<tree>

				<field name="name" string="Name" />
				<field name="sender" />
			</tree>

		</field>
	</record>

	<!-- MY RECEIPT ACTION -->
	<record id="hr_expense_actions_my_receipts" model="ir.actions.act_window">
		<field name="name">My Receipts</field>
		<field name="res_model">hrexpense.myreceipt</field>
		<field name="view_type">form</field>
		<field name="view_mode">kanban,tree,form</field>
		<field name="domain">[('employee_id.user_id', '=', uid),('state','=',
			'open')]</field>

		<field name="view_id" ref="receipts_kanban_view">
		</field>

	</record>


	<!-- ALL RECEIPT FORM VIEW -->
	<record id="all_receipts_form_view" model="ir.ui.view">
		<field name="name">All Receipts
		</field>
		<field name="model">hrexpense.myreceipt</field>
		<field name="arch" type="xml">
			<form create="false" edit="false">
				<sheet>
					<group>
						<field name="attachment" widget="image" class="image_file" />
						<field name="name" string="Name" />
						<field name="sender" />
						<field name="employee_id" />
						<field name="company_id" />
					</group>
				</sheet>
			</form>
		</field>
	</record>

	<record id="all_receipts_tree_view" model="ir.ui.view">
		<field name="name">All Receipts</field>
		<field name="model">hrexpense.myreceipt</field>
		<field name="arch" type="xml">
			<tree create="false">

				<field name="name" string="Name" />
				<field name="sender" />
			</tree>

		</field>
	</record>

	<!-- ALL RECEIPT ACTION -->
	<record id="hr_expense_actions_all_receipts" model="ir.actions.act_window">
		<field name="name">All Receipts</field>
		<field name="res_model">hrexpense.myreceipt</field>
		<field name="view_type">form</field>
		<field name="view_mode">kanban,tree,form</field>
		<field name="domain">['|', ('employee_id.parent_id.user_id', '=',
			uid),('employee_id.user_id', '=', uid),('state','=', 'open')]</field>
		<field name="view_id" ref="receipts_kanban_view">
		</field>
	</record>

	<menuitem id="menu_hr_expense_receipts" name="Receipts"
		sequence="1" parent="hr_expense.menu_hr_expense_root" groups="base.group_user" />
	<menuitem id="menu_hr_expense_to_my_receipt" name="My Receipts"
		sequence="1" parent="menu_hr_expense_receipts" action="hr_expense_actions_my_receipts"
		groups="group_expense_user" />
	<menuitem id="menu_hr_expense_all_receipts" name="All Receipts"
		sequence="2" parent="menu_hr_expense_receipts" action="hr_expense_actions_all_receipts"
		groups="hr_expense.group_hr_expense_user" />

	<menuitem id="hr_expense.menu_hr_expense_root" name="Expenses" sequence="100" web_icon="hr_expense,static/description/icon.png" groups="group_expense_user"/>
	<menuitem id="hr_expense.menu_hr_expense_my_expenses" name="My Expenses" sequence="1" parent="hr_expense.menu_hr_expense_root" groups="base.group_user,group_expense_user"/>


	<record id="view_hr_expense_sheet_tree_2" model="ir.ui.view">
        <field name="name">hr.expense.sheet.tree</field>
        <field name="model">hr.expense.sheet</field>
        <field name="arch" type="xml">
            <tree string="Expense Reports">
                <field name="name" string="Expense Sheet"/>
                <field name="accounting_date"/>
                <field name="employee_id"/>
                <field name="currency_id" invisible="1"/>
                <field name="total_amount" sum="Total Amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                <field name="state"/>
                <field name="message_unread" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="action_hr_expense_sheet_team_report" model="ir.actions.act_window">
        <field name="name">Team Reports</field>
        <field name="res_model">hr.expense.sheet</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_hr_expense_sheet_tree_2"/>
        <field name="context">{}</field>
    </record>


	<menuitem id="overall_team_hr_expense_sheets_root" name="Team Expenses" 
		sequence="2" parent="hr_expense.menu_hr_expense_root" />

	<menuitem id="overall_team_hr_expense" name="Team Expenses" 
		action="action_hr_expense_sheet_team_report"
		sequence="2" parent="overall_team_hr_expense_sheets_root" />



	<!-- <record id="hr_expense_form_view_inherit" model="ir.ui.view"> <field 
		name="name">hr.expense.form</field> <field name="model">hr.expense</field> 
		<field name="inherit_id" ref="hr_expense.hr_expense_form_view" /> <field 
		name="arch" type="xml"> <xpath expr="//field[@name='employee_id']" position="replace"> 
		<field name="employee_id" domain="[('employee_id.user_id','=',user.id)]" 
		/> </xpath> </field> </record> -->

</odoo>
